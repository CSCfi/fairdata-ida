--- /var/ida/nextcloud-old/settings/js/vue-settings-personal-security.js	2021-10-27 10:25:31.378497460 +0000
+++ /var/ida/nextcloud-old/settings/js/vue-settings-personal-security.js.original	2021-10-27 10:25:31.384497474 +0000
@@ -374,7 +374,7 @@
  * 
  * Licensed MIT Â© Zeno Rocha
  */
-t.exports=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=u(n(1)),a=u(n(3)),s=u(n(4));function u(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(t,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.resolveOptions(n),i.listenClick(t),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,a.default),r(e,[{key:"resolveOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof t.action?t.action:this.defaultAction,this.target="function"==typeof t.target?t.target:this.defaultTarget,this.text="function"==typeof t.text?t.text:this.defaultText,this.container="object"===i(t.container)?t.container:document.body}},{key:"listenClick",value:function(t){var e=this;this.listener=(0,s.default)(t,"click",function(t){return e.onClick(t)})}},{key:"onClick",value:function(t){var e=t.delegateTarget||t.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new o.default({action:this.action(e),target:this.target(e),text:this.text(e),container:this.container,trigger:e,emitter:this})}},{key:"defaultAction",value:function(t){return l("action",t)}},{key:"defaultTarget",value:function(t){var e=l("target",t);if(e)return document.querySelector(e)}},{key:"defaultText",value:function(t){return l("text",t)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:["copy","cut"],e="string"==typeof t?[t]:t,n=!!document.queryCommandSupported;return e.forEach(function(t){n=n&&!!document.queryCommandSupported(t)}),n}}]),e}();function l(t,e){var n="data-clipboard-"+t;if(e.hasAttribute(n))return e.getAttribute(n)}t.exports=c},function(t,e,n){"use strict";var i,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(2),s=(i=a)&&i.__esModule?i:{default:i},u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.resolveOptions(e),this.initSelection()}return o(t,[{key:"resolveOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action=t.action,this.container=t.container,this.emitter=t.emitter,this.target=t.target,this.text=t.text,this.trigger=t.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var t=this,e="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return t.removeFake()},this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[e?"right":"left"]="-9999px";var n=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=n+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.container.appendChild(this.fakeElem),this.selectedText=(0,s.default)(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,s.default)(this.target),this.copyText()}},{key:"copyText",value:function(){var t=void 0;try{t=document.execCommand(this.action)}catch(e){t=!1}this.handleResult(t)}},{key:"handleResult",value:function(t){this.emitter.emit(t?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=t,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(t){if(void 0!==t){if(!t||"object"!==(void 0===t?"undefined":r(t))||1!==t.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&t.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(t.hasAttribute("readonly")||t.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=t}},get:function(){return this._target}}]),t}();t.exports=u},function(t,e){t.exports=function(t){var e;if("SELECT"===t.nodeName)t.focus(),e=t.value;else if("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName){var n=t.hasAttribute("readonly");n||t.setAttribute("readonly",""),t.select(),t.setSelectionRange(0,t.value.length),n||t.removeAttribute("readonly"),e=t.value}else{t.hasAttribute("contenteditable")&&t.focus();var i=window.getSelection(),r=document.createRange();r.selectNodeContents(t),i.removeAllRanges(),i.addRange(r),e=i.toString()}return e}},function(t,e){function n(){}n.prototype={on:function(t,e,n){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var i=this;function r(){i.off(t,r),e.apply(n,arguments)}return r._=e,this.on(t,r,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),i=0,r=n.length;i<r;i++)n[i].fn.apply(n[i].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),i=n[t],r=[];if(i&&e)for(var o=0,a=i.length;o<a;o++)i[o].fn!==e&&i[o].fn._!==e&&r.push(i[o]);return r.length?n[t]=r:delete n[t],this}},t.exports=n},function(t,e,n){var i=n(5),r=n(6);t.exports=function(t,e,n){if(!t&&!e&&!n)throw new Error("Missing required arguments");if(!i.string(e))throw new TypeError("Second argument must be a String");if(!i.fn(n))throw new TypeError("Third argument must be a Function");if(i.node(t))return d=e,p=n,(f=t).addEventListener(d,p),{destroy:function(){f.removeEventListener(d,p)}};if(i.nodeList(t))return u=t,c=e,l=n,Array.prototype.forEach.call(u,function(t){t.addEventListener(c,l)}),{destroy:function(){Array.prototype.forEach.call(u,function(t){t.removeEventListener(c,l)})}};if(i.string(t))return o=t,a=e,s=n,r(document.body,o,a,s);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList");var o,a,s,u,c,l,f,d,p}},function(t,e){e.node=function(t){return void 0!==t&&t instanceof HTMLElement&&1===t.nodeType},e.nodeList=function(t){var n=Object.prototype.toString.call(t);return void 0!==t&&("[object NodeList]"===n||"[object HTMLCollection]"===n)&&"length"in t&&(0===t.length||e.node(t[0]))},e.string=function(t){return"string"==typeof t||t instanceof String},e.fn=function(t){return"[object Function]"===Object.prototype.toString.call(t)}},function(t,e,n){var i=n(7);function r(t,e,n,r,o){var a=function(t,e,n,r){return function(n){n.delegateTarget=i(n.target,e),n.delegateTarget&&r.call(t,n)}}.apply(this,arguments);return t.addEventListener(n,a,o),{destroy:function(){t.removeEventListener(n,a,o)}}}t.exports=function(t,e,n,i,o){return"function"==typeof t.addEventListener?r.apply(null,arguments):"function"==typeof n?r.bind(null,document).apply(null,arguments):("string"==typeof t&&(t=document.querySelectorAll(t)),Array.prototype.map.call(t,function(t){return r(t,e,n,i,o)}))}},function(t,e){if("undefined"!=typeof Element&&!Element.prototype.matches){var n=Element.prototype;n.matches=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector}t.exports=function(t,e){for(;t&&9!==t.nodeType;){if("function"==typeof t.matches&&t.matches(e))return t;t=t.parentNode}}}])},function(t,e,n){"use strict";var i=n(41);n.n(i).a},function(t,e,n){(t.exports=n(14)(!1)).push([t.i,"td[data-v-8b49f326] {\n  border-top: 1px solid var(--color-border);\n  max-width: 200px;\n  white-space: normal;\n  vertical-align: middle;\n  position: relative;\n}\ntd.more[data-v-8b49f326], td.client[data-v-8b49f326] {\n    overflow: visible;\n    position: relative;\n    width: 16px;\n}\ntd.token-name[data-v-8b49f326] {\n    padding: 10px 6px;\n}\ntd.token-name.token-rename[data-v-8b49f326] {\n      padding: 0;\n}\ntd.token-name input[data-v-8b49f326] {\n      width: 100%;\n      margin: 0;\n}\ntd.client div[data-v-8b49f326] {\n    opacity: 0.57;\n    width: 44px;\n    height: 44px;\n}\n",""])},function(t,e,n){"use strict";var i=n(42);n.n(i).a},function(t,e,n){(t.exports=n(14)(!1)).push([t.i,"table[data-v-99f1af2c] {\n  width: 100%;\n  min-height: 50px;\n  padding-top: 5px;\n  max-width: 580px;\n}\ntable th[data-v-99f1af2c] {\n    opacity: 1;\n    padding: 10px 10px 10px 0;\n}\n.token-list td > a.icon-more[data-v-99f1af2c] {\n  transition: opacity var(--animation-quick);\n}\n.token-list a.icon-more[data-v-99f1af2c] {\n  padding: 14px;\n  display: block;\n  width: 44px;\n  height: 44px;\n  opacity: .5;\n}\n.token-list tr:hover td > a.icon[data-v-99f1af2c],\n.token-list tr td > a.icon[data-v-99f1af2c]:focus,\n.token-list tr.active td > a.icon[data-v-99f1af2c] {\n  opacity: 1;\n}\n",""])},function(t,e,n){"use strict";var i=n(43);n.n(i).a},function(t,e,n){(t.exports=n(14)(!1)).push([t.i,"#app-tokens-table tr > *:nth-child(2) {\n  padding-left: 6px;\n}\n#app-tokens-table tr > *:nth-child(3) {\n  text-align: right;\n}\n",""])},function(t,e,n){"use strict";var i=n(44);n.n(i).a},function(t,e,n){(t.exports=n(14)(!1)).push([t.i,".app-password-row[data-v-68c31750] {\n  display: table-row;\n}\n.app-password-row .icon[data-v-68c31750] {\n    background-size: 16px 16px;\n    display: inline-block;\n    position: relative;\n    top: 3px;\n    margin-left: 5px;\n    margin-right: 8px;\n}\n.app-password-label[data-v-68c31750] {\n  display: table-cell;\n  padding-right: 1em;\n  text-align: right;\n  vertical-align: middle;\n}\n.monospaced[data-v-68c31750] {\n  width: 245px;\n  font-family: monospace;\n}\n",""])},function(e,n,i){"use strict";i.r(n);var r=i(2),o=i(46),a=i.n(o),s=i(38),u=i(4),c=i.n(u),l=i(17),f={ie:/(?:MSIE|Trident|Trident\/7.0; rv)[ :](\d+)/,edge:/^Mozilla\/5\.0 \([^)]+\) AppleWebKit\/[0-9.]+ \(KHTML, like Gecko\) Chrome\/[0-9.]+ (?:Mobile Safari|Safari)\/[0-9.]+ Edge\/[0-9.]+$/,firefox:/^Mozilla\/5\.0 \([^)]*(Windows|OS X|Linux)[^)]+\) Gecko\/[0-9.]+ Firefox\/(\d+)(?:\.\d)?$/,chrome:/^Mozilla\/5\.0 \([^)]*(Windows|OS X|Linux)[^)]+\) AppleWebKit\/[0-9.]+ \(KHTML, like Gecko\) Chrome\/(\d+)[0-9.]+ (?:Mobile Safari|Safari)\/[0-9.]+$/,safari:/^Mozilla\/5\.0 \([^)]*(Windows|OS X)[^)]+\) AppleWebKit\/[0-9.]+ \(KHTML, like Gecko\)(?: Version\/([0-9]+)[0-9.]+)? Safari\/[0-9.A-Z]+$/,androidChrome:/Android.*(?:; (.*) Build\/).*Chrome\/(\d+)[0-9.]+/,iphone:/ *CPU +iPhone +OS +([0-9]+)_(?:[0-9_])+ +like +Mac +OS +X */,ipad:/\(iPad\; *CPU +OS +([0-9]+)_(?:[0-9_])+ +like +Mac +OS +X */,iosClient:/^Mozilla\/5\.0 \(iOS\) (ownCloud|Nextcloud)\-iOS.*$/,androidClient:/^Mozilla\/5\.0 \(Android\) ownCloud\-android.*$/,iosTalkClient:/^Mozilla\/5\.0 \(iOS\) Nextcloud\-Talk.*$/,androidTalkClient:/^Mozilla\/5\.0 \(Android\) Nextcloud\-Talk.*$/,davDroid:/DAV(droid|x5)\/([0-9.]+)/,webPirate:/(Sailfish).*WebPirate\/(\d+)/,sailfishBrowser:/(Sailfish).*SailfishBrowser\/(\d+)/},d={ie:t("setting","Internet Explorer"),edge:t("setting","Edge"),firefox:t("setting","Firefox"),chrome:t("setting","Google Chrome"),safari:t("setting","Safari"),androidChrome:t("setting","Google Chrome for Android"),iphone:t("setting","iPhone"),ipad:t("setting","iPad"),iosClient:t("setting","Nextcloud iOS app"),androidClient:t("setting","Nextcloud Android app"),iosTalkClient:t("setting","Nextcloud Talk for iOS"),androidTalkClient:t("setting","Nextcloud Talk for Android"),davDroid:"DAVdroid",webPirate:"WebPirate",sailfishBrowser:"SailfishBrowser"},p={ie:"icon-desktop",edge:"icon-desktop",firefox:"icon-desktop",chrome:"icon-desktop",safari:"icon-desktop",androidChrome:"icon-phone",iphone:"icon-phone",ipad:"icon-tablet",iosClient:"icon-phone",androidClient:"icon-phone",iosTalkClient:"icon-phone",androidTalkClient:"icon-phone",davDroid:"icon-phone",webPirate:"icon-link",sailfishBrowser:"icon-link"},h={name:"AuthToken",components:{Action:l.Action},props:{token:{type:Object,required:!0}},computed:{actions:function(){var e=this,n=[];return 1===this.token.type&&n.push({input:"checkbox",action:function(){return e.$emit("toggleScope",e.token,"filesystem",!e.token.scope.filesystem)},model:this.token.scope.filesystem,text:t("settings","Allow filesystem access")}),this.token.canRename&&n.push({icon:"icon-rename",action:function(){return e.startRename()},text:t("settings","Rename")}),this.token.canDelete&&n.push({icon:"icon-delete",action:function(){return e.$emit("delete",e.token)},text:t("settings","Revoke")}),n},lastActivityRelative:function(){return OC.Util.relativeModifiedDate(1e3*this.token.lastActivity)},lastActivity:function(){return OC.Util.formatDate(1e3*this.token.lastActivity,"LLL")},iconName:function(){var e=this.token.name.match(/Mozilla\/5\.0 \((\w+)\) (?:mirall|csyncoC)\/(\d+\.\d+\.\d+)/),n="";e&&(this.token.name=t("settings","Sync client - {os}",{os:e[1],version:e[2]}),n="icon-desktop");var i=this.token.name,r=this.token.name;for(var o in f)(e=i.match(f[o]))&&(r=e[2]&&e[1]?d[o]+" "+e[2]+" - "+e[1]:e[1]?d[o]+" "+e[1]:d[o],n=p[o]);return this.token.current&&(r=t("settings","This session")),{icon:n,name:r}}},data:function(){return{showMore:this.token.canScope||this.token.canDelete,renaming:!1,newName:"",actionOpen:!1}},methods:{startRename:function(){var t=this;this.actionOpen=!1,this.newName=this.token.name,this.renaming=!0,this.$nextTick(function(){t.$refs.input.select()})},cancelRename:function(){this.renaming=!1},rename:function(){this.renaming=!1,this.$emit("rename",this.token,this.newName)}}},v=(i(52),i(5)),m={name:"AuthTokenList",components:{AuthToken:Object(v.a)(h,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("tr",{attrs:{"data-id":t.token.id}},[n("td",{staticClass:"client"},[n("div",{class:t.iconName.icon})]),t._v(" "),n("td",{staticClass:"token-name"},[t.token.canRename&&t.renaming?n("input",{directives:[{name:"model",rawName:"v-model",value:t.newName,expression:"newName"}],ref:"input",attrs:{type:"text"},domProps:{value:t.newName},on:{keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.rename(e)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.cancelRename(e)}],blur:t.cancelRename,input:function(e){e.target.composing||(t.newName=e.target.value)}}}):n("span",[t._v(t._s(t.iconName.name))])]),t._v(" "),n("td",[n("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.lastActivity,expression:"lastActivity"}],staticClass:"last-activity"},[t._v(t._s(t.lastActivityRelative))])]),t._v(" "),n("td",{staticClass:"more"},[t.token.current?t._e():n("Action",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("settings","Device settings"),container:"body"},expression:"{content: t('settings', 'Device settings'), container: 'body'}"}],attrs:{actions:t.actions,open:t.actionOpen,tabindex:"0"},on:{"update:open":function(e){t.actionOpen=e}}})],1)])},[],!1,null,"8b49f326",null).exports},props:{tokens:{type:Array,required:!0}},computed:{sortedTokens:function(){return this.tokens.sort(function(t,e){var n=parseInt(t.lastActivity,10);return parseInt(e.lastActivity,10)-n})}},methods:{toggleScope:function(t,e,n){this.$emit("toggleScope",t,e,n)},rename:function(t,e){this.$emit("rename",t,e)},onDelete:function(t){this.$emit("delete",t)}}},A=(i(54),i(56),Object(v.a)(m,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("table",{attrs:{id:"app-tokens-table"}},[t.tokens.length?n("thead",[n("tr",[n("th"),t._v(" "),n("th",[t._v(t._s(t.t("settings","Device")))]),t._v(" "),n("th",[t._v(t._s(t.t("settings","Last activity")))]),t._v(" "),n("th")])]):t._e(),t._v(" "),n("tbody",{staticClass:"token-list"},t._l(t.sortedTokens,function(e){return n("AuthToken",{key:e.id,attrs:{token:e},on:{toggleScope:t.toggleScope,rename:t.rename,delete:t.onDelete}})}),1)])},[],!1,null,"99f1af2c",null).exports),g=i(47),y=i(39),b=i.n(y);function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(e){_(t,e,n[e])})}return t}function _(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var x={name:"AuthTokenSetupDialogue",components:{QR:g.a},props:{add:{type:Function,required:!0}},data:function(){return{adding:!1,loading:!1,deviceName:"",appPassword:"",loginName:"",passwordCopied:!1,showQR:!1,qrUrl:"",hoveringCopyButton:!1}},computed:{copyTooltipOptions:function(){var e={hideOnTargetClick:!1,trigger:"manual"};return this.passwordCopied?w({},e,{content:t("core","Copied!"),show:!0}):w({},e,{content:t("core","Copy"),show:this.hoveringCopyButton})}},methods:{selectInput:function(t){t.currentTarget.select()},submit:function(){var e=this;b()().then(function(){return e.loading=!0,e.add(e.deviceName)}).then(function(t){e.adding=!0,e.loginName=t.loginName,e.appPassword=t.token;var n=window.location.protocol+"//"+window.location.host+OC.getRootPath();e.qrUrl="nc://login/user:".concat(t.loginName,"&password:").concat(t.token,"&server:").concat(n),e.$nextTick(function(){e.$refs.appPassword.select()})}).catch(function(n){console.error("could not create a new app password",n),OC.Notification.showTemporary(t("core","Error while creating device token")),e.reset()})},onCopyPassword:function(){var t=this;this.passwordCopied=!0,this.$refs.clipboardButton.blur(),setTimeout(function(){return t.passwordCopied=!1},3e3)},onCopyPasswordFailed:function(){OC.Notification.showTemporary(t("core","Could not copy app password. Please copy it manually."))},reset:function(){this.adding=!1,this.loading=!1,this.showQR=!1,this.qrUrl="",this.deviceName="",this.appPassword="",this.loginName=""}}},C=(i(58),Object(v.a)(x,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.adding?n("div",[t._v("\n\t"+t._s(t.t("settings","Use the credentials below to configure your app or device."))+"\n\t"+t._s(t.t("settings","For security reasons this password will only be shown once."))+"\n\t"),n("div",{staticClass:"app-password-row"},[n("span",{staticClass:"app-password-label"},[t._v(t._s(t.t("settings","Username")))]),t._v(" "),n("input",{staticClass:"monospaced",attrs:{type:"text",readonly:"readonly"},domProps:{value:t.loginName},on:{focus:t.selectInput}})]),t._v(" "),n("div",{staticClass:"app-password-row"},[n("span",{staticClass:"app-password-label"},[t._v(t._s(t.t("settings","Password")))]),t._v(" "),n("input",{ref:"appPassword",staticClass:"monospaced",attrs:{type:"text",readonly:"readonly"},domProps:{value:t.appPassword},on:{focus:t.selectInput}}),t._v(" "),n("a",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.copyTooltipOptions,expression:"copyTooltipOptions"},{name:"clipboard",rawName:"v-clipboard:copy",value:t.appPassword,expression:"appPassword",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.onCopyPassword,expression:"onCopyPassword",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:t.onCopyPasswordFailed,expression:"onCopyPasswordFailed",arg:"error"}],ref:"clipboardButton",staticClass:"icon icon-clippy",on:{mouseover:function(e){t.hoveringCopyButton=!0},mouseleave:function(e){t.hoveringCopyButton=!1}}}),t._v(" "),n("button",{staticClass:"button",on:{click:t.reset}},[t._v("\n\t\t\t"+t._s(t.t("settings","Done"))+"\n\t\t")])]),t._v(" "),n("div",{staticClass:"app-password-row"},[n("span",{staticClass:"app-password-label"}),t._v(" "),t.showQR?n("QR",{attrs:{value:t.qrUrl}}):n("a",{on:{click:function(e){t.showQR=!0}}},[t._v("\n\t\t\t"+t._s(t.t("settings","Show QR code for mobile apps"))+"\n\t\t")])],1)]):n("div",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.deviceName,expression:"deviceName"}],attrs:{type:"text",disabled:t.loading,placeholder:t.t("settings","App name")},domProps:{value:t.deviceName},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)},input:function(e){e.target.composing||(t.deviceName=e.target.value)}}}),t._v(" "),n("button",{staticClass:"button",attrs:{disabled:t.loading},on:{click:t.submit}},[t._v(t._s(t.t("settings","Create new app password"))+"\n\t")])])},[],!1,null,"68c31750",null).exports),E=function(t){return function(e){return t(e),e}},T={name:"AuthTokenSection",props:{tokens:{type:Array,requried:!0}},components:{AuthTokenSetupDialogue:C,AuthTokenList:A},data:function(){return{baseUrl:OC.generateUrl("/settings/personal/authtokens")}},methods:{addNewToken:function(e){var n=this;console.debug("creating a new app token",e);var i={name:e};return c.a.post(this.baseUrl,i).then(function(t){return t.data}).then(E(function(){return console.debug("app token created")})).then(E(function(t){return n.tokens.push(t.deviceToken)})).catch(function(e){throw console.error.bind("could not create app password",e),OC.Notification.showTemporary(t("core","Error while creating device token")),e})},toggleTokenScope:function(e,n,i){console.debug("updating app token scope",e.id,n,i);var r=e.scope[n];return e.scope[n]=i,this.updateToken(e).then(E(function(){return console.debug("app token scope updated")})).catch(function(i){throw console.error.bind("could not update app token scope",i),OC.Notification.showTemporary(t("core","Error while updating device token scope")),e.scope[n]=r,i})},rename:function(e,n){console.debug("renaming app token",e.id,e.name,n);var i=e.name;return e.name=n,this.updateToken(e).then(E(function(){return console.debug("app token name updated")})).catch(function(n){console.error.bind("could not update app token name",n),OC.Notification.showTemporary(t("core","Error while updating device token name")),e.name=i})},updateToken:function(t){return c.a.put(this.baseUrl+"/"+t.id,t).then(function(t){return t.data})},deleteToken:function(e){var n=this;return console.debug("deleting app token",e),this.tokens=this.tokens.filter(function(t){return t!==e}),c.a.delete(this.baseUrl+"/"+e.id).then(function(t){return t.data}).then(E(function(){return console.debug("app token deleted")})).catch(function(i){console.error.bind("could not delete app token",i),OC.Notification.showTemporary(t("core","Error while deleting the token")),n.tokens.push(e)})}}},k=Object(v.a)(T,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"section",attrs:{id:"security"}},[n("h2",[t._v(t._s(t.t("settings","Devices & sessions")))]),t._v(" "),n("p",{staticClass:"settings-hint hidden-when-empty"},[t._v(t._s(t.t("settings","Web, desktop and mobile clients currently logged in to your account.")))]),t._v(" "),n("AuthTokenList",{attrs:{tokens:t.tokens},on:{toggleScope:t.toggleTokenScope,rename:t.rename,delete:t.deleteToken}}),t._v(" "),n("AuthTokenSetupDialogue",{attrs:{add:t.addNewToken}})],1)},[],!1,null,"692682f4",null).exports;
+t.exports=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=u(n(1)),a=u(n(3)),s=u(n(4));function u(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(t,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.resolveOptions(n),i.listenClick(t),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,a.default),r(e,[{key:"resolveOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof t.action?t.action:this.defaultAction,this.target="function"==typeof t.target?t.target:this.defaultTarget,this.text="function"==typeof t.text?t.text:this.defaultText,this.container="object"===i(t.container)?t.container:document.body}},{key:"listenClick",value:function(t){var e=this;this.listener=(0,s.default)(t,"click",function(t){return e.onClick(t)})}},{key:"onClick",value:function(t){var e=t.delegateTarget||t.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new o.default({action:this.action(e),target:this.target(e),text:this.text(e),container:this.container,trigger:e,emitter:this})}},{key:"defaultAction",value:function(t){return l("action",t)}},{key:"defaultTarget",value:function(t){var e=l("target",t);if(e)return document.querySelector(e)}},{key:"defaultText",value:function(t){return l("text",t)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:["copy","cut"],e="string"==typeof t?[t]:t,n=!!document.queryCommandSupported;return e.forEach(function(t){n=n&&!!document.queryCommandSupported(t)}),n}}]),e}();function l(t,e){var n="data-clipboard-"+t;if(e.hasAttribute(n))return e.getAttribute(n)}t.exports=c},function(t,e,n){"use strict";var i,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(2),s=(i=a)&&i.__esModule?i:{default:i},u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.resolveOptions(e),this.initSelection()}return o(t,[{key:"resolveOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action=t.action,this.container=t.container,this.emitter=t.emitter,this.target=t.target,this.text=t.text,this.trigger=t.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var t=this,e="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return t.removeFake()},this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[e?"right":"left"]="-9999px";var n=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=n+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.container.appendChild(this.fakeElem),this.selectedText=(0,s.default)(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,s.default)(this.target),this.copyText()}},{key:"copyText",value:function(){var t=void 0;try{t=document.execCommand(this.action)}catch(e){t=!1}this.handleResult(t)}},{key:"handleResult",value:function(t){this.emitter.emit(t?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=t,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(t){if(void 0!==t){if(!t||"object"!==(void 0===t?"undefined":r(t))||1!==t.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&t.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(t.hasAttribute("readonly")||t.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=t}},get:function(){return this._target}}]),t}();t.exports=u},function(t,e){t.exports=function(t){var e;if("SELECT"===t.nodeName)t.focus(),e=t.value;else if("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName){var n=t.hasAttribute("readonly");n||t.setAttribute("readonly",""),t.select(),t.setSelectionRange(0,t.value.length),n||t.removeAttribute("readonly"),e=t.value}else{t.hasAttribute("contenteditable")&&t.focus();var i=window.getSelection(),r=document.createRange();r.selectNodeContents(t),i.removeAllRanges(),i.addRange(r),e=i.toString()}return e}},function(t,e){function n(){}n.prototype={on:function(t,e,n){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var i=this;function r(){i.off(t,r),e.apply(n,arguments)}return r._=e,this.on(t,r,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),i=0,r=n.length;i<r;i++)n[i].fn.apply(n[i].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),i=n[t],r=[];if(i&&e)for(var o=0,a=i.length;o<a;o++)i[o].fn!==e&&i[o].fn._!==e&&r.push(i[o]);return r.length?n[t]=r:delete n[t],this}},t.exports=n},function(t,e,n){var i=n(5),r=n(6);t.exports=function(t,e,n){if(!t&&!e&&!n)throw new Error("Missing required arguments");if(!i.string(e))throw new TypeError("Second argument must be a String");if(!i.fn(n))throw new TypeError("Third argument must be a Function");if(i.node(t))return d=e,p=n,(f=t).addEventListener(d,p),{destroy:function(){f.removeEventListener(d,p)}};if(i.nodeList(t))return u=t,c=e,l=n,Array.prototype.forEach.call(u,function(t){t.addEventListener(c,l)}),{destroy:function(){Array.prototype.forEach.call(u,function(t){t.removeEventListener(c,l)})}};if(i.string(t))return o=t,a=e,s=n,r(document.body,o,a,s);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList");var o,a,s,u,c,l,f,d,p}},function(t,e){e.node=function(t){return void 0!==t&&t instanceof HTMLElement&&1===t.nodeType},e.nodeList=function(t){var n=Object.prototype.toString.call(t);return void 0!==t&&("[object NodeList]"===n||"[object HTMLCollection]"===n)&&"length"in t&&(0===t.length||e.node(t[0]))},e.string=function(t){return"string"==typeof t||t instanceof String},e.fn=function(t){return"[object Function]"===Object.prototype.toString.call(t)}},function(t,e,n){var i=n(7);function r(t,e,n,r,o){var a=function(t,e,n,r){return function(n){n.delegateTarget=i(n.target,e),n.delegateTarget&&r.call(t,n)}}.apply(this,arguments);return t.addEventListener(n,a,o),{destroy:function(){t.removeEventListener(n,a,o)}}}t.exports=function(t,e,n,i,o){return"function"==typeof t.addEventListener?r.apply(null,arguments):"function"==typeof n?r.bind(null,document).apply(null,arguments):("string"==typeof t&&(t=document.querySelectorAll(t)),Array.prototype.map.call(t,function(t){return r(t,e,n,i,o)}))}},function(t,e){if("undefined"!=typeof Element&&!Element.prototype.matches){var n=Element.prototype;n.matches=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector}t.exports=function(t,e){for(;t&&9!==t.nodeType;){if("function"==typeof t.matches&&t.matches(e))return t;t=t.parentNode}}}])},function(t,e,n){"use strict";var i=n(41);n.n(i).a},function(t,e,n){(t.exports=n(14)(!1)).push([t.i,"td[data-v-8b49f326] {\n  border-top: 1px solid var(--color-border);\n  max-width: 200px;\n  white-space: normal;\n  vertical-align: middle;\n  position: relative;\n}\ntd.more[data-v-8b49f326], td.client[data-v-8b49f326] {\n    overflow: visible;\n    position: relative;\n    width: 16px;\n}\ntd.token-name[data-v-8b49f326] {\n    padding: 10px 6px;\n}\ntd.token-name.token-rename[data-v-8b49f326] {\n      padding: 0;\n}\ntd.token-name input[data-v-8b49f326] {\n      width: 100%;\n      margin: 0;\n}\ntd.client div[data-v-8b49f326] {\n    opacity: 0.57;\n    width: 44px;\n    height: 44px;\n}\n",""])},function(t,e,n){"use strict";var i=n(42);n.n(i).a},function(t,e,n){(t.exports=n(14)(!1)).push([t.i,"table[data-v-99f1af2c] {\n  width: 100%;\n  min-height: 50px;\n  padding-top: 5px;\n  max-width: 580px;\n}\ntable th[data-v-99f1af2c] {\n    opacity: .5;\n    padding: 10px 10px 10px 0;\n}\n.token-list td > a.icon-more[data-v-99f1af2c] {\n  transition: opacity var(--animation-quick);\n}\n.token-list a.icon-more[data-v-99f1af2c] {\n  padding: 14px;\n  display: block;\n  width: 44px;\n  height: 44px;\n  opacity: .5;\n}\n.token-list tr:hover td > a.icon[data-v-99f1af2c],\n.token-list tr td > a.icon[data-v-99f1af2c]:focus,\n.token-list tr.active td > a.icon[data-v-99f1af2c] {\n  opacity: 1;\n}\n",""])},function(t,e,n){"use strict";var i=n(43);n.n(i).a},function(t,e,n){(t.exports=n(14)(!1)).push([t.i,"#app-tokens-table tr > *:nth-child(2) {\n  padding-left: 6px;\n}\n#app-tokens-table tr > *:nth-child(3) {\n  text-align: right;\n}\n",""])},function(t,e,n){"use strict";var i=n(44);n.n(i).a},function(t,e,n){(t.exports=n(14)(!1)).push([t.i,".app-password-row[data-v-68c31750] {\n  display: table-row;\n}\n.app-password-row .icon[data-v-68c31750] {\n    background-size: 16px 16px;\n    display: inline-block;\n    position: relative;\n    top: 3px;\n    margin-left: 5px;\n    margin-right: 8px;\n}\n.app-password-label[data-v-68c31750] {\n  display: table-cell;\n  padding-right: 1em;\n  text-align: right;\n  vertical-align: middle;\n}\n.monospaced[data-v-68c31750] {\n  width: 245px;\n  font-family: monospace;\n}\n",""])},function(e,n,i){"use strict";i.r(n);var r=i(2),o=i(46),a=i.n(o),s=i(38),u=i(4),c=i.n(u),l=i(17),f={ie:/(?:MSIE|Trident|Trident\/7.0; rv)[ :](\d+)/,edge:/^Mozilla\/5\.0 \([^)]+\) AppleWebKit\/[0-9.]+ \(KHTML, like Gecko\) Chrome\/[0-9.]+ (?:Mobile Safari|Safari)\/[0-9.]+ Edge\/[0-9.]+$/,firefox:/^Mozilla\/5\.0 \([^)]*(Windows|OS X|Linux)[^)]+\) Gecko\/[0-9.]+ Firefox\/(\d+)(?:\.\d)?$/,chrome:/^Mozilla\/5\.0 \([^)]*(Windows|OS X|Linux)[^)]+\) AppleWebKit\/[0-9.]+ \(KHTML, like Gecko\) Chrome\/(\d+)[0-9.]+ (?:Mobile Safari|Safari)\/[0-9.]+$/,safari:/^Mozilla\/5\.0 \([^)]*(Windows|OS X)[^)]+\) AppleWebKit\/[0-9.]+ \(KHTML, like Gecko\)(?: Version\/([0-9]+)[0-9.]+)? Safari\/[0-9.A-Z]+$/,androidChrome:/Android.*(?:; (.*) Build\/).*Chrome\/(\d+)[0-9.]+/,iphone:/ *CPU +iPhone +OS +([0-9]+)_(?:[0-9_])+ +like +Mac +OS +X */,ipad:/\(iPad\; *CPU +OS +([0-9]+)_(?:[0-9_])+ +like +Mac +OS +X */,iosClient:/^Mozilla\/5\.0 \(iOS\) (ownCloud|Nextcloud)\-iOS.*$/,androidClient:/^Mozilla\/5\.0 \(Android\) ownCloud\-android.*$/,iosTalkClient:/^Mozilla\/5\.0 \(iOS\) Nextcloud\-Talk.*$/,androidTalkClient:/^Mozilla\/5\.0 \(Android\) Nextcloud\-Talk.*$/,davDroid:/DAV(droid|x5)\/([0-9.]+)/,webPirate:/(Sailfish).*WebPirate\/(\d+)/,sailfishBrowser:/(Sailfish).*SailfishBrowser\/(\d+)/},d={ie:t("setting","Internet Explorer"),edge:t("setting","Edge"),firefox:t("setting","Firefox"),chrome:t("setting","Google Chrome"),safari:t("setting","Safari"),androidChrome:t("setting","Google Chrome for Android"),iphone:t("setting","iPhone"),ipad:t("setting","iPad"),iosClient:t("setting","Nextcloud iOS app"),androidClient:t("setting","Nextcloud Android app"),iosTalkClient:t("setting","Nextcloud Talk for iOS"),androidTalkClient:t("setting","Nextcloud Talk for Android"),davDroid:"DAVdroid",webPirate:"WebPirate",sailfishBrowser:"SailfishBrowser"},p={ie:"icon-desktop",edge:"icon-desktop",firefox:"icon-desktop",chrome:"icon-desktop",safari:"icon-desktop",androidChrome:"icon-phone",iphone:"icon-phone",ipad:"icon-tablet",iosClient:"icon-phone",androidClient:"icon-phone",iosTalkClient:"icon-phone",androidTalkClient:"icon-phone",davDroid:"icon-phone",webPirate:"icon-link",sailfishBrowser:"icon-link"},h={name:"AuthToken",components:{Action:l.Action},props:{token:{type:Object,required:!0}},computed:{actions:function(){var e=this,n=[];return 1===this.token.type&&n.push({input:"checkbox",action:function(){return e.$emit("toggleScope",e.token,"filesystem",!e.token.scope.filesystem)},model:this.token.scope.filesystem,text:t("settings","Allow filesystem access")}),this.token.canRename&&n.push({icon:"icon-rename",action:function(){return e.startRename()},text:t("settings","Rename")}),this.token.canDelete&&n.push({icon:"icon-delete",action:function(){return e.$emit("delete",e.token)},text:t("settings","Revoke")}),n},lastActivityRelative:function(){return OC.Util.relativeModifiedDate(1e3*this.token.lastActivity)},lastActivity:function(){return OC.Util.formatDate(1e3*this.token.lastActivity,"LLL")},iconName:function(){var e=this.token.name.match(/Mozilla\/5\.0 \((\w+)\) (?:mirall|csyncoC)\/(\d+\.\d+\.\d+)/),n="";e&&(this.token.name=t("settings","Sync client - {os}",{os:e[1],version:e[2]}),n="icon-desktop");var i=this.token.name,r=this.token.name;for(var o in f)(e=i.match(f[o]))&&(r=e[2]&&e[1]?d[o]+" "+e[2]+" - "+e[1]:e[1]?d[o]+" "+e[1]:d[o],n=p[o]);return this.token.current&&(r=t("settings","This session")),{icon:n,name:r}}},data:function(){return{showMore:this.token.canScope||this.token.canDelete,renaming:!1,newName:"",actionOpen:!1}},methods:{startRename:function(){var t=this;this.actionOpen=!1,this.newName=this.token.name,this.renaming=!0,this.$nextTick(function(){t.$refs.input.select()})},cancelRename:function(){this.renaming=!1},rename:function(){this.renaming=!1,this.$emit("rename",this.token,this.newName)}}},v=(i(52),i(5)),m={name:"AuthTokenList",components:{AuthToken:Object(v.a)(h,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("tr",{attrs:{"data-id":t.token.id}},[n("td",{staticClass:"client"},[n("div",{class:t.iconName.icon})]),t._v(" "),n("td",{staticClass:"token-name"},[t.token.canRename&&t.renaming?n("input",{directives:[{name:"model",rawName:"v-model",value:t.newName,expression:"newName"}],ref:"input",attrs:{type:"text"},domProps:{value:t.newName},on:{keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.rename(e)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.cancelRename(e)}],blur:t.cancelRename,input:function(e){e.target.composing||(t.newName=e.target.value)}}}):n("span",[t._v(t._s(t.iconName.name))])]),t._v(" "),n("td",[n("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.lastActivity,expression:"lastActivity"}],staticClass:"last-activity"},[t._v(t._s(t.lastActivityRelative))])]),t._v(" "),n("td",{staticClass:"more"},[t.token.current?t._e():n("Action",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("settings","Device settings"),container:"body"},expression:"{content: t('settings', 'Device settings'), container: 'body'}"}],attrs:{actions:t.actions,open:t.actionOpen,tabindex:"0"},on:{"update:open":function(e){t.actionOpen=e}}})],1)])},[],!1,null,"8b49f326",null).exports},props:{tokens:{type:Array,required:!0}},computed:{sortedTokens:function(){return this.tokens.sort(function(t,e){var n=parseInt(t.lastActivity,10);return parseInt(e.lastActivity,10)-n})}},methods:{toggleScope:function(t,e,n){this.$emit("toggleScope",t,e,n)},rename:function(t,e){this.$emit("rename",t,e)},onDelete:function(t){this.$emit("delete",t)}}},A=(i(54),i(56),Object(v.a)(m,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("table",{attrs:{id:"app-tokens-table"}},[t.tokens.length?n("thead",[n("tr",[n("th"),t._v(" "),n("th",[t._v(t._s(t.t("settings","Device")))]),t._v(" "),n("th",[t._v(t._s(t.t("settings","Last activity")))]),t._v(" "),n("th")])]):t._e(),t._v(" "),n("tbody",{staticClass:"token-list"},t._l(t.sortedTokens,function(e){return n("AuthToken",{key:e.id,attrs:{token:e},on:{toggleScope:t.toggleScope,rename:t.rename,delete:t.onDelete}})}),1)])},[],!1,null,"99f1af2c",null).exports),g=i(47),y=i(39),b=i.n(y);function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(e){_(t,e,n[e])})}return t}function _(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var x={name:"AuthTokenSetupDialogue",components:{QR:g.a},props:{add:{type:Function,required:!0}},data:function(){return{adding:!1,loading:!1,deviceName:"",appPassword:"",loginName:"",passwordCopied:!1,showQR:!1,qrUrl:"",hoveringCopyButton:!1}},computed:{copyTooltipOptions:function(){var e={hideOnTargetClick:!1,trigger:"manual"};return this.passwordCopied?w({},e,{content:t("core","Copied!"),show:!0}):w({},e,{content:t("core","Copy"),show:this.hoveringCopyButton})}},methods:{selectInput:function(t){t.currentTarget.select()},submit:function(){var e=this;b()().then(function(){return e.loading=!0,e.add(e.deviceName)}).then(function(t){e.adding=!0,e.loginName=t.loginName,e.appPassword=t.token;var n=window.location.protocol+"//"+window.location.host+OC.getRootPath();e.qrUrl="nc://login/user:".concat(t.loginName,"&password:").concat(t.token,"&server:").concat(n),e.$nextTick(function(){e.$refs.appPassword.select()})}).catch(function(n){console.error("could not create a new app password",n),OC.Notification.showTemporary(t("core","Error while creating device token")),e.reset()})},onCopyPassword:function(){var t=this;this.passwordCopied=!0,this.$refs.clipboardButton.blur(),setTimeout(function(){return t.passwordCopied=!1},3e3)},onCopyPasswordFailed:function(){OC.Notification.showTemporary(t("core","Could not copy app password. Please copy it manually."))},reset:function(){this.adding=!1,this.loading=!1,this.showQR=!1,this.qrUrl="",this.deviceName="",this.appPassword="",this.loginName=""}}},C=(i(58),Object(v.a)(x,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.adding?n("div",[t._v("\n\t"+t._s(t.t("settings","Use the credentials below to configure your app or device."))+"\n\t"+t._s(t.t("settings","For security reasons this password will only be shown once."))+"\n\t"),n("div",{staticClass:"app-password-row"},[n("span",{staticClass:"app-password-label"},[t._v(t._s(t.t("settings","Username")))]),t._v(" "),n("input",{staticClass:"monospaced",attrs:{type:"text",readonly:"readonly"},domProps:{value:t.loginName},on:{focus:t.selectInput}})]),t._v(" "),n("div",{staticClass:"app-password-row"},[n("span",{staticClass:"app-password-label"},[t._v(t._s(t.t("settings","Password")))]),t._v(" "),n("input",{ref:"appPassword",staticClass:"monospaced",attrs:{type:"text",readonly:"readonly"},domProps:{value:t.appPassword},on:{focus:t.selectInput}}),t._v(" "),n("a",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.copyTooltipOptions,expression:"copyTooltipOptions"},{name:"clipboard",rawName:"v-clipboard:copy",value:t.appPassword,expression:"appPassword",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.onCopyPassword,expression:"onCopyPassword",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:t.onCopyPasswordFailed,expression:"onCopyPasswordFailed",arg:"error"}],ref:"clipboardButton",staticClass:"icon icon-clippy",on:{mouseover:function(e){t.hoveringCopyButton=!0},mouseleave:function(e){t.hoveringCopyButton=!1}}}),t._v(" "),n("button",{staticClass:"button",on:{click:t.reset}},[t._v("\n\t\t\t"+t._s(t.t("settings","Done"))+"\n\t\t")])]),t._v(" "),n("div",{staticClass:"app-password-row"},[n("span",{staticClass:"app-password-label"}),t._v(" "),t.showQR?n("QR",{attrs:{value:t.qrUrl}}):n("a",{on:{click:function(e){t.showQR=!0}}},[t._v("\n\t\t\t"+t._s(t.t("settings","Show QR code for mobile apps"))+"\n\t\t")])],1)]):n("div",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.deviceName,expression:"deviceName"}],attrs:{type:"text",disabled:t.loading,placeholder:t.t("settings","App name")},domProps:{value:t.deviceName},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)},input:function(e){e.target.composing||(t.deviceName=e.target.value)}}}),t._v(" "),n("button",{staticClass:"button",attrs:{disabled:t.loading},on:{click:t.submit}},[t._v(t._s(t.t("settings","Create new app password"))+"\n\t")])])},[],!1,null,"68c31750",null).exports),E=function(t){return function(e){return t(e),e}},T={name:"AuthTokenSection",props:{tokens:{type:Array,requried:!0}},components:{AuthTokenSetupDialogue:C,AuthTokenList:A},data:function(){return{baseUrl:OC.generateUrl("/settings/personal/authtokens")}},methods:{addNewToken:function(e){var n=this;console.debug("creating a new app token",e);var i={name:e};return c.a.post(this.baseUrl,i).then(function(t){return t.data}).then(E(function(){return console.debug("app token created")})).then(E(function(t){return n.tokens.push(t.deviceToken)})).catch(function(e){throw console.error.bind("could not create app password",e),OC.Notification.showTemporary(t("core","Error while creating device token")),e})},toggleTokenScope:function(e,n,i){console.debug("updating app token scope",e.id,n,i);var r=e.scope[n];return e.scope[n]=i,this.updateToken(e).then(E(function(){return console.debug("app token scope updated")})).catch(function(i){throw console.error.bind("could not update app token scope",i),OC.Notification.showTemporary(t("core","Error while updating device token scope")),e.scope[n]=r,i})},rename:function(e,n){console.debug("renaming app token",e.id,e.name,n);var i=e.name;return e.name=n,this.updateToken(e).then(E(function(){return console.debug("app token name updated")})).catch(function(n){console.error.bind("could not update app token name",n),OC.Notification.showTemporary(t("core","Error while updating device token name")),e.name=i})},updateToken:function(t){return c.a.put(this.baseUrl+"/"+t.id,t).then(function(t){return t.data})},deleteToken:function(e){var n=this;return console.debug("deleting app token",e),this.tokens=this.tokens.filter(function(t){return t!==e}),c.a.delete(this.baseUrl+"/"+e.id).then(function(t){return t.data}).then(E(function(){return console.debug("app token deleted")})).catch(function(i){console.error.bind("could not delete app token",i),OC.Notification.showTemporary(t("core","Error while deleting the token")),n.tokens.push(e)})}}},k=Object(v.a)(T,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"section",attrs:{id:"security"}},[n("h2",[t._v(t._s(t.t("settings","Devices & sessions")))]),t._v(" "),n("p",{staticClass:"settings-hint hidden-when-empty"},[t._v(t._s(t.t("settings","Web, desktop and mobile clients currently logged in to your account.")))]),t._v(" "),n("AuthTokenList",{attrs:{tokens:t.tokens},on:{toggleScope:t.toggleTokenScope,rename:t.rename,delete:t.deleteToken}}),t._v(" "),n("AuthTokenSetupDialogue",{attrs:{add:t.addNewToken}})],1)},[],!1,null,"692682f4",null).exports;
 /*
  * @copyright 2019 Christoph Wurst <christoph@winzerhof-wurst.at>
  *
